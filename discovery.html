<!DOCTYPE html>
<html lang="en" class="h-full" style="background: var(--color-bg-main);">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Discovery - Nimbus Trading Platform</title>

  <!-- Fonts: Geist + Geist Mono -->
  <link href="https://cdn.jsdelivr.net/npm/@fontsource/geist/400.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@fontsource/geist/500.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@fontsource/geist/600.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@fontsource/geist/700.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@fontsource/geist-mono/400.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@fontsource/geist-mono/500.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@fontsource/geist-mono/600.css" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link rel="stylesheet" href="assets/css/components.css">
  <script src="assets/js/navbar.js"></script>

  <style>
    /* Discovery Page Styles - Full Width Layout */
    .discovery-container {
      width: 100vw;
      margin-left: calc(-50vw + 50%);
      margin-right: calc(-50vw + 50%);
    }

    .full-width {
      width: 100vw;
      margin-left: calc(-50vw + 50%);
      margin-right: calc(-50vw + 50%);
    }

    .top-bar {
      position: sticky;
      top: 0;
      z-index: 50;
      background: rgba(10, 12, 16, 0.95);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--color-border-subtle);
    }

    .bar {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem 1rem;
      max-width: none;
    }

    .search {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      background: rgba(11, 15, 20, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 0.375rem;
      padding: 0.375rem 0.5rem;
      flex: 1;
      max-width: 300px;
    }

    .search input {
      background: transparent;
      border: none;
      color: white;
      outline: none;
      flex: 1;
    }

    .search input::placeholder {
      color: rgba(156, 163, 175, 0.7);
    }

    .chips {
      display: flex;
      gap: 0.25rem;
      flex-wrap: wrap;
      align-items: center;
    }

    .chips:not(:last-child)::after {
      content: '|';
      color: rgba(156, 163, 175, 0.3);
      margin: 0 0.5rem;
    }

    .chips button {
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      background: rgba(55, 65, 81, 0.6);
      color: rgba(156, 163, 175, 0.9);
      border: none;
      font-size: 0.75rem;
      transition: all 0.15s ease;
    }

    .chips button[aria-pressed="true"] {
      background: rgba(110, 231, 183, 0.2);
      color: rgba(110, 231, 183, 1);
    }

    .chips button:hover {
      background: rgba(75, 85, 99, 0.7);
      color: rgba(229, 231, 235, 1);
    }

    .utils {
      display: flex;
      gap: 0.25rem;
    }

    .utils button {
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      background: rgba(55, 65, 81, 0.6);
      color: rgba(156, 163, 175, 0.9);
      border: none;
      font-size: 0.75rem;
    }

    .row {
      width: 100%;
      padding: 0.5rem 1rem;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 0.5rem;
      background: rgba(11, 15, 20, 0.3);
    }

    .tile {
      background: rgba(11, 15, 20, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 0.5rem;
      padding: 0.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      position: relative;
    }

    .tile .lead {
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }

    .tile .lead img {
      width: 0.875rem;
      height: 0.875rem;
    }

    .tile .lead h2 {
      font-size: 0.75rem;
      font-weight: 500;
    }

    .tile .kpi {
      display: flex;
      align-items: baseline;
      gap: 0.25rem;
    }

    .tile .kpi output {
      font-size: 1rem;
      font-weight: 700;
      color: white;
    }

    .tile .kpi small {
      color: rgba(156, 163, 175, 0.8);
      font-size: 0.625rem;
    }

    .tile .trade-btn {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      padding: 0.25rem 0.5rem;
      background: linear-gradient(135deg, rgba(110, 231, 183, 1) 0%, rgba(52, 211, 153, 1) 100%);
      color: rgba(0, 0, 0, 0.9);
      border: none;
      border-radius: 0.25rem;
      font-size: 0.625rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .tile .trade-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(110, 231, 183, 0.3);
    }

    .tile img {
      max-height: 12px !important;
      object-fit: contain;
    }

    /* Gauge Styles */
    .gauge-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }

    .gauge {
      position: relative;
      width: 80px;
      height: 40px;
    }

    .gauge-track {
      position: relative;
      width: 100%;
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
    }

    .gauge-segment {
      position: absolute;
      top: 0;
      height: 100%;
    }

    .gauge-segment.fear { left: 0%; width: 20%; background: #ef4444; }
    .gauge-segment.fear-neutral { left: 20%; width: 20%; background: #f97316; }
    .gauge-segment.neutral { left: 40%; width: 20%; background: #eab308; }
    .gauge-segment.neutral-greed { left: 60%; width: 20%; background: #84cc16; }
    .gauge-segment.greed { left: 80%; width: 20%; background: #22c55e; }

    .gauge-indicator {
      position: absolute;
      top: -4px;
      left: 50%;
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
      transform-origin: center;
      transform: translateX(-50%) rotate(0deg);
      transition: transform 0.3s ease;
    }

    .gauge-value {
      text-align: center;
    }

    .gauge-value output {
      display: block;
      font-size: 1.25rem;
      font-weight: 600;
      color: white;
    }

    .gauge-value small {
      font-size: 0.75rem;
      color: rgba(156, 163, 175, 0.9);
    }

    /* Progress Bar Styles */
    .progress-bars {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .progress-item {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .progress-item label {
      font-size: 0.75rem;
      color: rgba(156, 163, 175, 0.9);
    }

    .progress-bar {
      position: relative;
      height: 6px;
      background: rgba(55, 65, 81, 0.6);
      border-radius: 3px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      transition: width 0.3s ease;
    }

    .progress-fill.btc {
      background: linear-gradient(90deg, #f97316, #fbbf24, #9ca3af);
    }

    .progress-fill.alt {
      background: linear-gradient(90deg, #9ca3af, #3b82f6);
    }

    .progress-handle {
      position: absolute;
      top: -2px;
      width: 10px;
      height: 10px;
      background: white;
      border-radius: 50%;
      transform: translateX(-50%);
      transition: left 0.3s ease;
    }

    /* RSI Slider Styles */
    .rsi-slider {
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .rsi-track {
      position: relative;
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
    }

    .rsi-segment {
      position: absolute;
      top: 0;
      height: 100%;
    }

    .rsi-segment.oversold { left: 0%; width: 20%; background: #06b6d4; }
    .rsi-segment.neutral-low { left: 20%; width: 20%; background: #10b981; }
    .rsi-segment.neutral { left: 40%; width: 20%; background: #6b7280; }
    .rsi-segment.neutral-high { left: 60%; width: 20%; background: #9ca3af; }
    .rsi-segment.overbought { left: 80%; width: 20%; background: #ef4444; }

    .rsi-handle {
      position: absolute;
      top: -2px;
      width: 12px;
      height: 12px;
      background: white;
      border-radius: 50%;
      transform: translateX(-50%);
      transition: left 0.3s ease;
    }

    .rsi-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.625rem;
      color: rgba(156, 163, 175, 0.7);
    }

    /* Chart Container */
    .chart-container {
      height: 20px;
      overflow: hidden;
    }

    .chart-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Negative values */
    .negative {
      color: #ef4444 !important;
    }

    .tabs {
      display: flex;
      gap: 0.25rem;
      border-bottom: 1px solid var(--color-border-subtle);
      background: rgba(11, 15, 20, 0.3);
    }

    .tabs button {
      padding: 0.5rem 0.75rem;
      background: transparent;
      border: none;
      color: rgba(156, 163, 175, 0.9);
      border-bottom: 2px solid transparent;
      transition: all 0.15s ease;
      font-size: 0.875rem;
    }

    .tabs button[aria-selected="true"] {
      color: rgba(110, 231, 183, 1);
      border-bottom-color: rgba(110, 231, 183, 1);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 0.75rem;
    }

    .card {
      background: rgba(11, 15, 20, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 0.5rem;
      padding: 0.75rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .card .badges {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      flex-wrap: wrap;
    }

    .card .badges img {
      width: 0.75rem;
      height: 0.75rem;
    }

    .card .badges span {
      background: rgba(110, 231, 183, 0.1);
      color: rgba(110, 231, 183, 0.9);
      padding: 0.125rem 0.25rem;
      border-radius: 0.125rem;
      font-size: 0.625rem;
    }

    .card h3 {
      font-size: 1rem;
      font-weight: 600;
      color: white;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .card h3 img {
      width: 1rem;
      height: 1rem;
    }

    .card p {
      font-size: 0.75rem;
      color: rgba(156, 163, 175, 0.8);
    }

    .card .kpis {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .card .kpis output {
      font-size: 1.125rem;
      font-weight: 700;
      color: white;
    }

    .card .kpis small {
      color: rgba(156, 163, 175, 0.8);
      font-size: 0.75rem;
    }

    .card .actions {
      display: flex;
      gap: 0.25rem;
      margin-top: auto;
    }

    .card .actions button {
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      background: rgba(55, 65, 81, 0.6);
      color: rgba(156, 163, 175, 0.9);
      border: none;
      font-size: 0.75rem;
      transition: all 0.15s ease;
    }

    .card .actions button:hover {
      background: rgba(75, 85, 99, 0.7);
      color: rgba(229, 231, 235, 1);
    }

    .table {
      background: rgba(11, 15, 20, 0.3);
    }

    .table table {
      width: 100%;
      border-collapse: collapse;
    }

    .table th,
    .table td {
      padding: 0.5rem;
      text-align: left;
      border-bottom: 1px solid var(--color-border-subtle);
      font-size: 0.875rem;
    }

    .table th {
      color: rgba(156, 163, 175, 0.9);
      font-weight: 500;
      font-size: 0.75rem;
    }

    .table td {
      color: white;
    }

    .list {
      background: rgba(11, 15, 20, 0.3);
    }

    .news {
      display: flex;
      gap: 0.75rem;
      padding: 0.75rem;
      border-bottom: 1px solid var(--color-border-subtle);
    }

    .news .thumb {
      width: 2.5rem;
      height: 2.5rem;
      border-radius: 0.25rem;
      object-fit: cover;
    }

    .news .body {
      flex: 1;
    }

    .news .body h3 {
      color: white;
      font-weight: 600;
      margin-bottom: 0.25rem;
      font-size: 0.875rem;
    }

    .news .body p {
      color: rgba(156, 163, 175, 0.8);
      font-size: 0.75rem;
    }

    .news .actions {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .news .actions button {
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      background: rgba(55, 65, 81, 0.6);
      color: rgba(156, 163, 175, 0.9);
      border: none;
      font-size: 0.75rem;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(8px);
      z-index: 100;
      display: flex;
      flex-direction: column;
    }

    .overlay.hidden {
      display: none;
    }

    .story .hero {
      background: rgba(11, 15, 20, 0.95);
      border-bottom: 1px solid var(--color-border-subtle);
      padding: 2rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      position: relative;
    }

    .story .hero img {
      width: 3rem;
      height: 3rem;
    }

    .story .hero h2 {
      color: white;
      font-size: 1.5rem;
      font-weight: 600;
    }

    .story .hero .pills {
      display: flex;
      gap: 0.5rem;
      margin-left: auto;
    }

    .story .hero .pills span {
      background: rgba(110, 231, 183, 0.1);
      color: rgba(110, 231, 183, 0.9);
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.75rem;
    }

    .story .hero button {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      color: rgba(156, 163, 175, 0.9);
      font-size: 1.5rem;
      cursor: pointer;
    }

    .story .content {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
    }

    .kpi-fullrow {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin: 2rem 0;
    }

    .kpi-fullrow dl {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 0.5rem 1rem;
    }

    .kpi-fullrow dt {
      color: rgba(156, 163, 175, 0.8);
    }

    .kpi-fullrow dd {
      color: white;
      font-weight: 600;
    }

    .actions-wide {
      display: flex;
      gap: 1rem;
      margin: 2rem 0;
    }

    .actions-wide button {
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      background: linear-gradient(135deg, rgba(110, 231, 183, 1) 0%, rgba(52, 211, 153, 1) 100%);
      color: rgba(0, 0, 0, 0.9);
      border: none;
      font-weight: 600;
    }

    .related-wide ul {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .related-wide button {
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      background: rgba(55, 65, 81, 0.6);
      color: rgba(156, 163, 175, 0.9);
      border: none;
    }

    .provenance {
      margin-top: 2rem;
      padding-top: 2rem;
      border-top: 1px solid var(--color-border-subtle);
    }

    .provenance small {
      color: rgba(156, 163, 175, 0.6);
      display: block;
      margin-bottom: 0.25rem;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .bar {
        flex-direction: column;
        gap: 1rem;
        padding: 1rem;
      }

      .search {
        max-width: none;
      }

      .chips {
        overflow-x: auto;
        padding-bottom: 0.5rem;
      }

      .stats {
        grid-template-columns: 1fr;
      }

      .grid {
        grid-template-columns: 1fr;
      }

      .tabs {
        overflow-x: auto;
      }

      .table {
        overflow-x: auto;
      }

      .news {
        flex-direction: column;
      }

      .kpi-fullrow {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body class="h-full text-gray-200 antialiased bg-gradient-main">
  <div class="min-h-screen flex flex-col">
    <!-- Navbar Container -->
    <div id="navbar-container"></div>

    <!-- Discovery Page -->
    <main aria-label="Discovery" class="discovery-container">
      
      <!-- 1) TOP BAR (single line; minimal controls; sticky; full-width) -->
      <header role="banner" class="top-bar">
        <div class="bar">
          <div role="search" class="search">
            <img alt="" src="https://api.iconify.design/mdi/magnify.svg" width="16" height="16" />
            <input aria-label="Search tokens, HIP-3, news" placeholder="Search tokens, HIP-3, news…" />
          </div>
          <!-- Content type filters -->
          <nav aria-label="Content filters" class="chips">
            <button data-chip="all" aria-pressed="true">All</button>
            <button data-chip="hip3">HIP-3</button>
            <button data-chip="perps">Perps</button>
            <button data-chip="spot">Spot</button>
            <button data-chip="news">News</button>
          </nav>
          <!-- Timeframe filters -->
          <nav aria-label="Timeframe filters" class="chips">
            <button data-chip="tf" data-value="1h">1h</button>
            <button data-chip="tf" data-value="24h" aria-pressed="true">24h</button>
            <button data-chip="tf" data-value="7d">7d</button>
            <button data-chip="tf" data-value="30d">30d</button>
          </nav>
          <!-- Sort options -->
          <nav aria-label="Sort options" class="chips">
            <button data-chip="sort" data-value="trending" aria-pressed="true">Trending</button>
            <button data-chip="sort" data-value="volume">Volume</button>
            <button data-chip="sort" data-value="price">Price</button>
            <button data-chip="sort" data-value="change">Change</button>
          </nav>
          <!-- Utility functions -->
          <div class="utils">
            <button title="My Watchlist">📋</button>
            <button title="Price Alerts">🔔</button>
            <button title="RSS Feed">📡</button>
          </div>
        </div>
      </header>

      <!-- 2) STATS STRIP (full-bleed row with 5 expanding tiles) -->
      <section aria-label="Market Sentiment" class="row stats">
        <article class="tile market-cap">
          <button class="trade-btn" onclick="openTrade('market')">Trade</button>
          <div class="lead">
            <h2>Market Cap</h2>
            <img alt="" src="https://api.iconify.design/mdi/arrow-right.svg" />
          </div>
          <div class="kpi">
            <output data-bind="marketCap.value">$4.04T</output>
            <small data-bind="marketCap.change" class="negative">-0.93%</small>
          </div>
          <div class="chart-container">
            <img alt="Market Cap spark" data-bind-src="marketCap.series" />
          </div>
        </article>
        
        <article class="tile cmc20">
          <button class="trade-btn" onclick="openTrade('cmc20')">Trade</button>
          <div class="lead">
            <h2>CMC20</h2>
            <img alt="" src="https://api.iconify.design/mdi/arrow-right.svg" />
          </div>
          <div class="kpi">
            <output data-bind="cmc20.value">$256.47</output>
            <small data-bind="cmc20.change" class="negative">-0.9%</small>
          </div>
          <div class="chart-container">
            <img alt="CMC20 spark" data-bind-src="cmc20.series" />
          </div>
        </article>
        
        <article class="tile fear-greed">
          <button class="trade-btn" onclick="openTrade('fgi')">Trade</button>
          <div class="lead">
            <h2>Fear & Greed</h2>
            <img alt="" src="https://api.iconify.design/mdi/arrow-right.svg" />
          </div>
          <div class="gauge-container">
            <div class="gauge">
              <div class="gauge-track">
                <div class="gauge-segment fear"></div>
                <div class="gauge-segment fear-neutral"></div>
                <div class="gauge-segment neutral"></div>
                <div class="gauge-segment neutral-greed"></div>
                <div class="gauge-segment greed"></div>
              </div>
              <div class="gauge-indicator" data-bind-style="transform: rotate(fgi.angle)deg"></div>
            </div>
            <div class="gauge-value">
              <output data-bind="fgi.value">48</output>
              <small data-bind="fgi.label">Neutral</small>
            </div>
          </div>
        </article>
        
        <article class="tile altcoin-season">
          <button class="trade-btn" onclick="openTrade('alt')">Trade</button>
          <div class="lead">
            <h2>Altcoin Season</h2>
            <img alt="" src="https://api.iconify.design/mdi/arrow-right.svg" />
          </div>
          <div class="kpi">
            <output data-bind="altseason.value">75/100</output>
          </div>
          <div class="progress-bars">
            <div class="progress-item">
              <label>Bitcoin</label>
              <div class="progress-bar">
                <div class="progress-fill btc" data-bind-style="width: btcDom.percentage%"></div>
                <div class="progress-handle" data-bind-style="left: btcDom.percentage%"></div>
              </div>
            </div>
            <div class="progress-item">
              <label>Altcoin</label>
              <div class="progress-bar">
                <div class="progress-fill alt" data-bind-style="width: altseason.percentage%"></div>
                <div class="progress-handle" data-bind-style="left: altseason.percentage%"></div>
              </div>
            </div>
          </div>
        </article>
        
        <article class="tile crypto-rsi">
          <button class="trade-btn" onclick="openTrade('rsi')">Trade</button>
          <div class="lead">
            <h2>Average Crypto RSI</h2>
            <img alt="" src="https://api.iconify.design/mdi/arrow-right.svg" />
          </div>
          <div class="kpi">
            <output data-bind="rsi.value">46.83</output>
          </div>
          <div class="rsi-slider">
            <div class="rsi-track">
              <div class="rsi-segment oversold"></div>
              <div class="rsi-segment neutral-low"></div>
              <div class="rsi-segment neutral"></div>
              <div class="rsi-segment neutral-high"></div>
              <div class="rsi-segment overbought"></div>
            </div>
            <div class="rsi-handle" data-bind-style="left: rsi.percentage%"></div>
            <div class="rsi-labels">
              <span>Oversold</span>
              <span>Overbought</span>
            </div>
          </div>
        </article>
      </section>

      <!-- 3) TABS (full-width) -->
      <nav class="tabs" role="tablist" aria-label="Sections">
        <button role="tab" aria-selected="true" data-tab="trending">Trending</button>
        <button role="tab" data-tab="hip3">HIP-3</button>
        <button role="tab" data-tab="perps">Perps</button>
        <button role="tab" data-tab="spot">Spot</button>
        <button role="tab" data-tab="news">News</button>
      </nav>

      <!-- 4) TRENDING STRIP (full-bleed, responsive grid; cards expand) -->
      <section role="tabpanel" aria-label="Trending" class="row grid auto-fit" id="trending-panel">
        <!-- HIP-3 Perp Card (HL) -->
        <article class="card">
          <header class="badges">
            <img alt="" src="https://api.iconify.design/mdi/playlist-star.svg" />
            <span>HIP-3 Perp</span>
            <span data-bind="hl.maxLeverage">Max Lev: 10x</span>
          </header>
          <h3 data-bind="hl.symbol">vSTRIPE</h3>
          <p data-bind="hl.instrument">vntls:vSTRIPE</p>
          <div class="kpis">
            <output data-bind="hl.markPx">--</output>
            <small data-bind="pct(prevDayPx, markPx)">--%</small>
            <small data-bind="hl.openInterest">OI: --</small>
            <small data-bind="hl.funding">F: --</small>
          </div>
          <img alt="series" data-bind-src="quickchartUrl(line(hl.candles.map(c=>c.c)))" width="100%" height="50" />
          <footer class="actions">
            <button aria-haspopup="dialog" onclick="openStory('hl')">Story ▸</button>
            <button>Watch</button>
            <button>Trade</button>
          </footer>
        </article>

        <!-- Perp Card (CoinGecko logo + sparkline) -->
        <article class="card">
          <header class="badges">
            <img alt="" src="https://api.iconify.design/mdi/chart-line-variant.svg" /><span>Perp</span>
          </header>
          <h3><img alt="" data-bind-src="row.image" /> ETH-PERP</h3>
          <div class="kpis"><output data-bind="row.price">--</output><small data-bind="row.change24h">--%</small></div>
          <img alt="spark" data-bind-src="quickchartUrl(line(row.spark))" width="100%" height="50" />
          <footer class="actions"><button aria-haspopup="dialog" onclick="openStory('perp')">Story ▸</button><button>Watch</button><button>Trade</button></footer>
        </article>

        <!-- News Card (thumbnail if present) -->
        <article class="card">
          <img class="thumb" alt="" data-bind-src="news.thumb || 'https://api.iconify.design/mdi/newspaper.svg'" width="100%" height="80" style="object-fit: cover;" />
          <h3 data-bind="news.title">Headline</h3>
          <p><small data-bind="news.source">Source</small> · <time data-bind="news.published">--</time></p>
          <footer class="actions"><button aria-haspopup="dialog" onclick="openStory('news')">Open Story ▸</button><a target="_blank" rel="noopener" data-bind-href="news.link">Read</a></footer>
        </article>

        <!-- Repeat more cards; grid auto-fits to fill each row fully -->
      </section>

      <!-- 5) HIP-3 GRID (full-width; all universe items; auto-fit, fills rows) -->
      <section role="tabpanel" hidden aria-label="HIP-3" class="row grid auto-fit" id="hip3-panel">
        <!-- For each HL universe[i] + marketCtxs[i] -->
        <article class="card">
          <header class="badges">
            <img alt="" src="https://api.iconify.design/mdi/chart-bell-curve.svg" />
            <span>HIP-3 Perp</span>
            <span data-bind="u.maxLeverage">Max Lev: --x</span>
          </header>
          <h3 data-bind="u.symbol">vCURSOR</h3>
          <p data-bind="u.name">vntls:vCURSOR</p>
          <div class="kpis">
            <output data-bind="m.markPx">--</output>
            <small data-bind="pct(m.prevDayPx, m.markPx)">--%</small>
            <small data-bind="m.openInterest">OI: --</small>
            <small data-bind="m.funding">F: --</small>
          </div>
          <img alt="series" data-bind-src="quickchartUrl(line(candles(u.name).map(c=>c.c)))" width="100%" height="50" />
          <footer class="actions"><button aria-haspopup="dialog" onclick="openStory('hip3')">Story ▸</button><button>Watch</button><button>Trade</button></footer>
        </article>
      </section>

      <!-- 6) PERPS TABLE (full-width; fills container) -->
      <section role="tabpanel" hidden aria-label="Perps" class="row table" id="perps-panel">
        <table role="table" aria-label="Perp markets">
          <thead>
            <tr><th aria-sort="none">Symbol</th><th>Price</th><th>24h %</th><th>OI</th><th>Funding</th><th>Volume</th><th>Spark</th><th>Story</th></tr>
          </thead>
          <tbody>
            <tr>
              <td><img alt="" src="https://api.iconify.design/mdi/alpha-h-circle.svg" width="20" height="20" /> <strong data-bind="hl.symbol">vSTRIPE</strong> <small>HL Testnet</small></td>
              <td data-bind="hl.markPx">--</td>
              <td data-bind="pct(prevDayPx, markPx)">--%</td>
              <td data-bind="hl.openInterest">--</td>
              <td data-bind="hl.funding">--</td>
              <td data-bind="hl.dayNtlVlm">--</td>
              <td><img alt="" data-bind-src="quickchartUrl(line(hl.candles.map(c=>c.c)))" width="80" height="30" /></td>
              <td><button aria-haspopup="dialog" onclick="openStory('hl')">Story ▸</button></td>
            </tr>
            <!-- More rows (HL + other perps) -->
          </tbody>
        </table>
      </section>

      <!-- 7) SPOT TABLE (full-width) -->
      <section role="tabpanel" hidden aria-label="Spot" class="row table" id="spot-panel">
        <table role="table" aria-label="Spot markets">
          <thead><tr><th>Symbol</th><th>Price</th><th>24h %</th><th>Mkt Cap</th><th>Volume</th><th>Spark</th><th>Story</th></tr></thead>
          <tbody><!-- CoinGecko rows; logo row.image; sparkline_in_7d.price → QuickChart --></tbody>
        </table>
      </section>

      <!-- 8) NEWS STREAM (full-width; each item stretches) -->
      <section role="tabpanel" hidden aria-label="News" class="row list" id="news-panel">
        <article class="news">
          <img class="thumb" alt="" data-bind-src="news.thumb || 'https://api.iconify.design/mdi/newspaper.svg'" />
          <div class="body">
            <h3 data-bind="news.title">Headline</h3>
            <p><small data-bind="news.source">Source</small> · <time data-bind="news.published">--</time></p>
            <div class="tags"><!-- tags --></div>
          </div>
          <div class="actions">
            <button aria-haspopup="dialog" onclick="openStory('news')">Open Story ▸</button>
            <a target="_blank" rel="noopener" data-bind-href="news.link">Read</a>
          </div>
        </article>
        <!-- Repeat; each article fills row width -->
      </section>

      <!-- 9) STORY OVERLAY (full-width dialog that covers content) -->
      <div role="dialog" aria-modal="true" hidden class="overlay story" id="story-overlay">
        <header class="hero">
          <img alt="" data-bind-src="selected.icon || selected.logo" />
          <h2 data-bind="selected.name">Item Name</h2>
          <div class="pills"><span data-bind="selected.type">HIP-3 Perp</span><span data-bind="selected.tags">Sentiment</span></div>
          <button aria-label="Close" onclick="closeStory()">✕</button>
        </header>
        <section class="content">
          <article aria-label="Story">
            <h3>Story</h3>
            <p data-bind="selected.story.summary">…</p>
            <p data-bind="selected.story.method">…</p>
            <p data-bind="selected.story.whyMatters">…</p>
          </article>
          <section aria-label="Key Metrics" class="kpi-fullrow">
            <dl>
              <dt>Mark</dt><dd data-bind="hl.markPx">--</dd>
              <dt>Oracle</dt><dd data-bind="hl.oraclePx">--</dd>
              <dt>Premium</dt><dd data-bind="hl.premium">--</dd>
              <dt>Funding</dt><dd data-bind="hl.funding">--</dd>
              <dt>Max Lev</dt><dd data-bind="hl.maxLeverage">--x</dd>
            </dl>
            <img alt="OHLC" data-bind-src="quickchartUrl(ohlc(selected.candles))" width="100%" height="200" />
          </section>
          <section class="actions-wide">
            <button hidden data-bind-hidden="!selected.tradable">Open in Trade</button>
            <button>Add to Watchlist</button>
          </section>
          <section aria-label="Related" class="related-wide">
            <ul><li><button>Related HIP-3</button></li><li><button>Related Token</button></li><li><button>Related News</button></li></ul>
          </section>
          <footer class="provenance">
            <small>Source: HL Testnet (metaAndAssetCtxs: vntls) · Indices from Alternative.me & CoinGecko</small>
            <small>Last updated: <time data-bind="selected.lastUpdated">--</time></small>
          </footer>
        </section>
      </div>

      <!-- 10) STATES (full-width rows) -->
      <section aria-label="States" class="row">
        <div data-state="loading" id="loading-state">Loading…</div>
        <div data-state="empty" id="empty-state" style="display: none;">No results. Adjust top filters.</div>
        <div data-state="error" id="error-state" style="display: none;">Couldn't load data. Retry.</div>
      </section>

      <!-- 11) PAGINATION (full-width) -->
      <nav aria-label="Pagination" class="row">
        <button onclick="loadMore()">Load more</button>
      </nav>
    </main>
  </div>

  <script>
    // Discovery Page JavaScript
    let currentTab = 'trending';
    let currentFilters = { 
      contentType: 'all',
      timeframe: '24h',
      sortBy: 'trending'
    };
    let discoveryData = {
      fgi: { value: '--', delta24h: '--%', series: [], label: '--', angle: 0 },
      btcDom: { value: '--%', delta24h: '--%', series: [], percentage: 0 },
      altseason: { value: '--', label: '--', series: [], percentage: 75 },
      marketCap: { value: '$4.04T', change: '-0.93%', series: [] },
      cmc20: { value: '$256.47', change: '-0.9%', series: [] },
      rsi: { value: 46.83, percentage: 46.83 },
      hl: {
        universe: [],
        marketCtxs: [],
        candles: {},
        maxLeverage: '10x',
        symbol: 'vSTRIPE',
        instrument: 'vntls:vSTRIPE',
        markPx: '--',
        openInterest: '--',
        funding: '--',
        dayNtlVlm: '--'
      },
      spot: [],
      news: []
    };

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      initTabs();
      initFilters();
      loadMarketData();
      loadHLData();
    });

    // Tab functionality
    function initTabs() {
      const tabs = document.querySelectorAll('[role="tab"]');
      const panels = document.querySelectorAll('[role="tabpanel"]');
      
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const tabName = tab.dataset.tab;
          
          // Update tab states
          tabs.forEach(t => t.setAttribute('aria-selected', 'false'));
          tab.setAttribute('aria-selected', 'true');
          
          // Show/hide panels
          panels.forEach(panel => {
            panel.hidden = true;
          });
          
          const targetPanel = document.getElementById(`${tabName}-panel`);
          if (targetPanel) {
            targetPanel.hidden = false;
          }
          
          currentTab = tabName;
        });
      });
    }

    // Filter functionality
    function initFilters() {
      // Content type filters
      const contentChips = document.querySelectorAll('[aria-label="Content filters"] button');
      contentChips.forEach(chip => {
        chip.addEventListener('click', () => {
          const chipType = chip.dataset.chip;
          
          // Reset all content filters
          contentChips.forEach(c => c.setAttribute('aria-pressed', 'false'));
          chip.setAttribute('aria-pressed', 'true');
          
          currentFilters.contentType = chipType;
          applyFilters();
        });
      });

      // Timeframe filters
      const timeChips = document.querySelectorAll('[aria-label="Timeframe filters"] button');
      timeChips.forEach(chip => {
        chip.addEventListener('click', () => {
          const timeValue = chip.dataset.value;
          
          // Reset all timeframe filters
          timeChips.forEach(c => c.setAttribute('aria-pressed', 'false'));
          chip.setAttribute('aria-pressed', 'true');
          
          currentFilters.timeframe = timeValue;
          applyFilters();
        });
      });

      // Sort options
      const sortChips = document.querySelectorAll('[aria-label="Sort options"] button');
      sortChips.forEach(chip => {
        chip.addEventListener('click', () => {
          const sortValue = chip.dataset.value;
          
          // Reset all sort options
          sortChips.forEach(c => c.setAttribute('aria-pressed', 'false'));
          chip.setAttribute('aria-pressed', 'true');
          
          currentFilters.sortBy = sortValue;
          applyFilters();
        });
      });
    }

    // Apply current filters
    function applyFilters() {
      console.log('Applying filters:', currentFilters);
      // Filter logic would go here
    }

    // Load market data from APIs
    async function loadMarketData() {
      try {
        // Load Fear & Greed Index
        const fgiResponse = await fetch('https://api.alternative.me/fng/?limit=30');
        const fgiData = await fgiResponse.json();
        if (fgiData.data && fgiData.data.length > 0) {
          const latest = fgiData.data[0];
          const previous = fgiData.data[1];
          discoveryData.fgi.value = latest.value;
          discoveryData.fgi.delta24h = previous ? 
            ((parseInt(latest.value) - parseInt(previous.value)).toFixed(1) + '%') : '0%';
          discoveryData.fgi.series = fgiData.data.map(d => parseInt(d.value));
          
          // Calculate gauge angle (0-180 degrees for semicircle)
          const angle = (latest.value / 100) * 180;
          discoveryData.fgi.angle = angle;
          
          // Set label based on value
          if (latest.value <= 25) discoveryData.fgi.label = 'Extreme Fear';
          else if (latest.value <= 45) discoveryData.fgi.label = 'Fear';
          else if (latest.value <= 55) discoveryData.fgi.label = 'Neutral';
          else if (latest.value <= 75) discoveryData.fgi.label = 'Greed';
          else discoveryData.fgi.label = 'Extreme Greed';
        }

        // Load BTC Dominance from CoinGecko
        const globalResponse = await fetch('https://api.coingecko.com/api/v3/global');
        const globalData = await globalResponse.json();
        if (globalData.data) {
          const btcDomValue = parseFloat(globalData.data.market_cap_percentage.btc);
          discoveryData.btcDom.value = btcDomValue.toFixed(1) + '%';
          discoveryData.btcDom.percentage = btcDomValue; // For progress bar
          // Mock BTC dominance series (CoinGecko doesn't provide historical dominance)
          discoveryData.btcDom.series = generateMockSeries(30, btcDomValue);
          discoveryData.btcDom.delta24h = '0.2%'; // Mock change
        }

        // Load spot market data with sparklines
        const marketsResponse = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=20&page=1&sparkline=true');
        const marketsData = await marketsResponse.json();
        discoveryData.spot = marketsData;

        // Load news data (mock for now - would need RSS parser)
        discoveryData.news = [
          {
            title: "Bitcoin Reaches New All-Time High",
            source: "CoinDesk",
            published: "2 hours ago",
            link: "https://coindesk.com",
            thumb: "https://api.iconify.design/mdi/bitcoin.svg"
          },
          {
            title: "Ethereum 2.0 Staking Rewards Increase",
            source: "The Block",
            published: "4 hours ago", 
            link: "https://theblock.co",
            thumb: "https://api.iconify.design/mdi/ethereum.svg"
          }
        ];

        // Generate altcoin season data (mock - would come from real API)
        // Mock Market Cap data
        discoveryData.marketCap.series = generateMockSeries(30, 4.04);
        
        // Mock CMC20 data
        discoveryData.cmc20.series = generateMockSeries(30, 256.47);
        
        // Mock Altcoin Season data
        discoveryData.altseason.series = generateMockSeries(30, 75);

        updateUI();
      } catch (error) {
        console.error('Error loading market data:', error);
        showError();
      }
    }

    // Load Hyperliquid Testnet data
    async function loadHLData() {
      try {
        // Try to fetch real Hyperliquid Testnet data
        try {
          const universeResponse = await fetch('https://api.hyperliquid-testnet.xyz/info', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ type: 'perpDexs' })
          });
          
          if (universeResponse.ok) {
            const universeData = await universeResponse.json();
            console.log('HL Universe data:', universeData);
            
            // Try to get market contexts
            const ctxResponse = await fetch('https://api.hyperliquid-testnet.xyz/info', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ type: 'metaAndAssetCtxs', dex: 'vntls' })
            });
            
            if (ctxResponse.ok) {
              const ctxData = await ctxResponse.json();
              console.log('HL Market contexts:', ctxData);
              
              // Process real data if available
              if (universeData && ctxData) {
                discoveryData.hl.universe = universeData.slice(0, 5); // Limit to first 5
                discoveryData.hl.marketCtxs = ctxData.slice(0, 5);
              }
            }
          }
        } catch (apiError) {
          console.log('HL API not available, using mock data:', apiError);
        }
        
        // Fallback to mock data if API fails
        if (!discoveryData.hl.universe.length) {
          discoveryData.hl.universe = [
            { name: 'vntls:vSTRIPE', symbol: 'vSTRIPE', maxLeverage: 10 },
            { name: 'vntls:vCURSOR', symbol: 'vCURSOR', maxLeverage: 10 },
            { name: 'vntls:vGOOGL', symbol: 'vGOOGL', maxLeverage: 10 },
            { name: 'vntls:vTSLA', symbol: 'vTSLA', maxLeverage: 10 },
            { name: 'vntls:vNVDA', symbol: 'vNVDA', maxLeverage: 10 }
          ];
          
          discoveryData.hl.marketCtxs = [
            { markPx: '0.95', oraclePx: '0.94', prevDayPx: '0.92', openInterest: '1.2M', dayNtlVlm: '500K', funding: '0.01%', premium: '1.06%' },
            { markPx: '2.45', oraclePx: '2.44', prevDayPx: '2.40', openInterest: '800K', dayNtlVlm: '300K', funding: '0.02%', premium: '1.02%' },
            { markPx: '145.20', oraclePx: '145.15', prevDayPx: '143.80', openInterest: '2.1M', dayNtlVlm: '800K', funding: '0.03%', premium: '1.03%' },
            { markPx: '245.80', oraclePx: '245.70', prevDayPx: '242.50', openInterest: '1.5M', dayNtlVlm: '600K', funding: '0.04%', premium: '1.04%' },
            { markPx: '485.20', oraclePx: '485.10', prevDayPx: '480.30', openInterest: '3.2M', dayNtlVlm: '1.2M', funding: '0.02%', premium: '1.02%' }
          ];
        }

        // Generate candle data for all instruments
        discoveryData.hl.universe.forEach((instrument, index) => {
          const basePrice = parseFloat(discoveryData.hl.marketCtxs[index]?.markPx || '1.0');
          discoveryData.hl.candles[instrument.name] = generateMockCandles(100, basePrice);
        });

        updateUI();
      } catch (error) {
        console.error('Error loading HL data:', error);
        showError();
      }
    }

    // Generate mock candle data
    function generateMockCandles(count, basePrice = 1.0) {
      const candles = [];
      let price = basePrice;
      const now = Date.now();
      
      for (let i = 0; i < count; i++) {
        const change = (Math.random() - 0.5) * 0.02; // ±1% change
        price *= (1 + change);
        
        candles.push({
          t: now - (count - i) * 60000, // 1 minute intervals
          o: price * 0.999,
          h: price * 1.001,
          l: price * 0.998,
          c: price,
          v: Math.random() * 1000
        });
      }
      
      return candles;
    }

    // Generate mock series data
    function generateMockSeries(count, baseValue) {
      const series = [];
      let value = baseValue;
      
      for (let i = 0; i < count; i++) {
        const change = (Math.random() - 0.5) * 0.1; // ±5% change
        value *= (1 + change);
        series.push(Math.max(0, value)); // Ensure non-negative
      }
      
      return series;
    }

    // Update UI with loaded data
    function updateUI() {
      // Update stats tiles
      document.querySelector('[data-bind="marketCap.value"]').textContent = discoveryData.marketCap.value;
      document.querySelector('[data-bind="marketCap.change"]').textContent = discoveryData.marketCap.change;
      
      document.querySelector('[data-bind="cmc20.value"]').textContent = discoveryData.cmc20.value;
      document.querySelector('[data-bind="cmc20.change"]').textContent = discoveryData.cmc20.change;
      
      document.querySelector('[data-bind="fgi.value"]').textContent = discoveryData.fgi.value;
      document.querySelector('[data-bind="fgi.label"]').textContent = discoveryData.fgi.label;
      
      document.querySelector('[data-bind="btcDom.value"]').textContent = discoveryData.btcDom.value;
      document.querySelector('[data-bind="btcDom.delta24h"]').textContent = discoveryData.btcDom.delta24h;

      document.querySelector('[data-bind="altseason.value"]').textContent = discoveryData.altseason.value;
      
      document.querySelector('[data-bind="rsi.value"]').textContent = discoveryData.rsi.value;

      // Update chart URLs
      updateChartUrls();
      
      // Update gauge and progress bar styles
      updateGaugeStyles();
      
      // Populate trending cards with real data
      populateTrendingCards();
      
      // Populate spot table with real data
      populateSpotTable();
      
      // Populate news section
      populateNewsSection();
      
      // Hide loading state
      document.getElementById('loading-state').style.display = 'none';
    }

    // Populate trending cards with real data
    function populateTrendingCards() {
      const trendingPanel = document.getElementById('trending-panel');
      
      // Clear existing cards except the first HIP-3 card
      const existingCards = trendingPanel.querySelectorAll('.card');
      for (let i = 1; i < existingCards.length; i++) {
        existingCards[i].remove();
      }
      
      // Add top cryptocurrencies as cards
      discoveryData.spot.slice(0, 5).forEach((coin, index) => {
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          <header class="badges">
            <img alt="" src="https://api.iconify.design/mdi/chart-line-variant.svg" />
            <span>Spot</span>
            <span>#${coin.market_cap_rank || 'N/A'}</span>
          </header>
          <h3><img alt="" src="${coin.image}" width="24" height="24" /> ${coin.symbol.toUpperCase()}</h3>
          <p>${coin.name}</p>
          <div class="kpis">
            <output>$${coin.current_price?.toFixed(2) || '--'}</output>
            <small class="${coin.price_change_percentage_24h >= 0 ? 'text-green-400' : 'text-red-400'}">${coin.price_change_percentage_24h?.toFixed(2) || '--'}%</small>
            <small>Vol: $${(coin.total_volume / 1000000).toFixed(1)}M</small>
            <small>Cap: $${(coin.market_cap / 1000000000).toFixed(1)}B</small>
          </div>
          <img alt="spark" src="${generateQuickChartUrl(coin.sparkline_in_7d?.price || [])}" width="100%" height="50" />
          <footer class="actions">
            <button aria-haspopup="dialog" onclick="openStory('spot-${coin.id}')">Story ▸</button>
            <button>Watch</button>
            <button>Trade</button>
          </footer>
        `;
        trendingPanel.appendChild(card);
      });
      
      // Add news cards
      discoveryData.news.forEach(news => {
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          <img class="thumb" alt="" src="${news.thumb}" width="100%" height="80" style="object-fit: cover;" />
          <h3>${news.title}</h3>
          <p><small>${news.source}</small> · <time>${news.published}</time></p>
          <footer class="actions">
            <button aria-haspopup="dialog" onclick="openStory('news-${news.source}')">Open Story ▸</button>
            <a target="_blank" rel="noopener" href="${news.link}">Read</a>
          </footer>
        `;
        trendingPanel.appendChild(card);
      });
    }

    // Populate spot table with real data
    function populateSpotTable() {
      const spotTable = document.querySelector('#spot-panel tbody');
      spotTable.innerHTML = '';
      
      discoveryData.spot.forEach(coin => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>
            <img alt="" src="${coin.image}" width="20" height="20" /> 
            <strong>${coin.symbol.toUpperCase()}</strong> 
            <small>${coin.name}</small>
          </td>
          <td>$${coin.current_price?.toFixed(2) || '--'}</td>
          <td class="${coin.price_change_percentage_24h >= 0 ? 'text-green-400' : 'text-red-400'}">${coin.price_change_percentage_24h?.toFixed(2) || '--'}%</td>
          <td>$${(coin.market_cap / 1000000000).toFixed(1)}B</td>
          <td>$${(coin.total_volume / 1000000).toFixed(1)}M</td>
          <td><img alt="" src="${generateQuickChartUrl(coin.sparkline_in_7d?.price || [])}" width="80" height="30" /></td>
          <td><button aria-haspopup="dialog" onclick="openStory('spot-${coin.id}')">Story ▸</button></td>
        `;
        spotTable.appendChild(row);
      });
    }

    // Populate news section
    function populateNewsSection() {
      const newsPanel = document.getElementById('news-panel');
      newsPanel.innerHTML = '';
      
      discoveryData.news.forEach(news => {
        const article = document.createElement('article');
        article.className = 'news';
        article.innerHTML = `
          <img class="thumb" alt="" src="${news.thumb}" />
          <div class="body">
            <h3>${news.title}</h3>
            <p><small>${news.source}</small> · <time>${news.published}</time></p>
            <div class="tags"></div>
          </div>
          <div class="actions">
            <button aria-haspopup="dialog" onclick="openStory('news-${news.source}')">Open Story ▸</button>
            <a target="_blank" rel="noopener" href="${news.link}">Read</a>
          </div>
        `;
        newsPanel.appendChild(article);
      });
    }

    // Update gauge and progress bar styles
    function updateGaugeStyles() {
      // Update Fear & Greed gauge angle
      const gaugeIndicator = document.querySelector('.gauge-indicator');
      if (gaugeIndicator) {
        gaugeIndicator.style.transform = `translateX(-50%) rotate(${discoveryData.fgi.angle}deg)`;
      }
      
      // Update BTC Dominance progress bar
      const btcProgressFill = document.querySelector('.progress-fill.btc');
      const btcProgressHandle = document.querySelector('.progress-item:first-child .progress-handle');
      if (btcProgressFill && btcProgressHandle) {
        btcProgressFill.style.width = `${discoveryData.btcDom.percentage}%`;
        btcProgressHandle.style.left = `${discoveryData.btcDom.percentage}%`;
      }
      
      // Update Altcoin Season progress bar
      const altProgressFill = document.querySelector('.progress-fill.alt');
      const altProgressHandle = document.querySelector('.progress-item:last-child .progress-handle');
      if (altProgressFill && altProgressHandle) {
        altProgressFill.style.width = `${discoveryData.altseason.percentage}%`;
        altProgressHandle.style.left = `${discoveryData.altseason.percentage}%`;
      }
      
      // Update RSI slider
      const rsiHandle = document.querySelector('.rsi-handle');
      if (rsiHandle) {
        rsiHandle.style.left = `${discoveryData.rsi.percentage}%`;
      }
    }

    // Update chart URLs
    function updateChartUrls() {
      const chartElements = document.querySelectorAll('[data-bind-src]');
      
      chartElements.forEach(el => {
        const dataType = el.dataset.bindSrc;
        
        if (dataType === 'marketCap.series') {
          el.src = generateQuickChartUrl(discoveryData.marketCap.series);
        } else if (dataType === 'cmc20.series') {
          el.src = generateQuickChartUrl(discoveryData.cmc20.series);
        } else if (dataType === 'fgi.series') {
          el.src = generateQuickChartUrl(discoveryData.fgi.series);
        } else if (dataType === 'btcDom.series') {
          el.src = generateQuickChartUrl(discoveryData.btcDom.series);
        } else if (dataType === 'altseason.series') {
          el.src = generateQuickChartUrl(discoveryData.altseason.series);
        } else if (dataType.includes('hl.candles')) {
          const candles = discoveryData.hl.candles['vntls:vSTRIPE'] || [];
          const closes = candles.map(c => c.c);
          el.src = generateQuickChartUrl(closes);
        }
      });
    }

    // Generate QuickChart URL
    function generateQuickChartUrl(data) {
      // Ensure we have valid data
      if (!data || data.length === 0) {
        return 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEyIiB2aWV3Qm94PSIwIDAgMjAwIDEyIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTIiIGZpbGw9InRyYW5zcGFyZW50Ii8+PC9zdmc+';
      }
      
      const config = {
        type: 'sparkline',
        data: {
          datasets: [{
            data: data,
            borderColor: '#6EE7B7',
            backgroundColor: 'rgba(110, 231, 183, 0.1)',
            borderWidth: 1,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: { display: false },
            y: { display: false }
          },
          elements: {
            point: { radius: 0 }
          },
          plugins: {
            legend: { display: false }
          },
          layout: {
            padding: 0
          }
        }
      };
      
      return `https://quickchart.io/chart?c=${encodeURIComponent(JSON.stringify(config))}`;
    }

    // Story overlay functions
    function openStory(type) {
      const overlay = document.getElementById('story-overlay');
      overlay.hidden = false;
      document.body.style.overflow = 'hidden';
      
      // Set story content based on type
      const selected = {
        name: type === 'hl' ? 'vSTRIPE' : type === 'perp' ? 'ETH-PERP' : 'News Story',
        type: type === 'hl' ? 'HIP-3 Perp' : type === 'perp' ? 'Perp' : 'News',
        icon: type === 'hl' ? 'https://api.iconify.design/mdi/alpha-h-circle.svg' : 
              type === 'perp' ? 'https://api.iconify.design/mdi/chart-line-variant.svg' :
              'https://api.iconify.design/mdi/newspaper.svg',
        story: {
          summary: 'This is a sample story summary...',
          method: 'Trading methodology explanation...',
          whyMatters: 'Why this matters for traders...'
        },
        lastUpdated: new Date().toLocaleString()
      };
      
      // Update story content
      document.querySelector('[data-bind="selected.name"]').textContent = selected.name;
      document.querySelector('[data-bind="selected.type"]').textContent = selected.type;
      document.querySelector('[data-bind="selected.icon"]').src = selected.icon;
      document.querySelector('[data-bind="selected.story.summary"]').textContent = selected.story.summary;
      document.querySelector('[data-bind="selected.story.method"]').textContent = selected.story.method;
      document.querySelector('[data-bind="selected.story.whyMatters"]').textContent = selected.story.whyMatters;
      document.querySelector('[data-bind="selected.lastUpdated"]').textContent = selected.lastUpdated;
    }

    function closeStory() {
      const overlay = document.getElementById('story-overlay');
      overlay.hidden = true;
      document.body.style.overflow = 'auto';
    }

    // Load more functionality
    function loadMore() {
      console.log('Loading more data...');
      // Implementation would load additional data
    }

    // Error handling
    function showError() {
      document.getElementById('loading-state').style.display = 'none';
      document.getElementById('error-state').style.display = 'block';
    }

    // Close story on Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeStory();
      }
    });

    // Trade button functionality
    function openTrade(type) {
      console.log('Opening trade for:', type);
      
      // Map trade types to symbols
      const tradeMap = {
        'fgi': 'BTCUSDT', // Fear & Greed -> BTC
        'btc': 'BTCUSDT', // BTC Dominance -> BTC
        'alt': 'ETHUSDT'  // Altcoin Season -> ETH
      };
      
      const symbol = tradeMap[type] || 'BTCUSDT';
      
      // In a real app, this would open the trading interface
      // For now, we'll show an alert or redirect to charts page
      if (confirm(`Open trading for ${symbol}?`)) {
        // Redirect to charts page with the symbol
        window.location.href = `index.html?symbol=${symbol}`;
      }
    }
  </script>
</body>
</html>
